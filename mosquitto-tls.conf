# Mosquitto MQTT Broker Configuration for TLS Security
# 
# File location: /etc/mosquitto/conf.d/mosquitto.conf
# 
# Description:
# - Listener on port 8883 (MQTT over TLS)
# - TLS 1.2+ required (no legacy SSL)
# - Client authentication via username/password
# - CA, server certificate, and server key loaded

# ============================================================================
# TLS CONFIGURATION (Port 8883 - Secure MQTT)
# ============================================================================

listener 8883

# CA certificate (for verifying client certificates in future)
cafile /etc/mosquitto/certs/ca.crt

# Server certificate
certfile /etc/mosquitto/certs/server.crt

# Server private key
keyfile /etc/mosquitto/certs/server.key

# Minimum TLS version (1.2 or higher)
tls_version tlsv1.2

# ============================================================================
# AUTHENTICATION CONFIGURATION
# ============================================================================

# Disable anonymous connections (require authentication)
allow_anonymous false

# Password file for client authentication
# Generate with: sudo mosquitto_passwd -c /etc/mosquitto/passwd esp32_client
password_file /etc/mosquitto/passwd

# ============================================================================
# OPTIONAL: PLAINTEXT LISTENER (Port 1883 - FOR TESTING ONLY)
# ============================================================================
# 
# Uncomment below to allow plaintext MQTT on port 1883 (NOT recommended for production)
# 
# listener 1883
# allow_anonymous true
#

# ============================================================================
# BROKER CONFIGURATION
# ============================================================================

# Persistence settings
persistence true
persistence_location /var/lib/mosquitto/

# Logging
log_dest file /var/log/mosquitto/mosquitto.log
log_dest stdout
log_type all
log_timestamp true

# Default port (legacy, usually overridden by listener directives)
# port 1883

# Process ID file
pid_file /var/run/mosquitto.pid

# ============================================================================
# END OF CONFIGURATION
# ============================================================================
